// #ifdef MP-WEIXIN
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Utils={devVer:1,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getScreenHeight:function(t){return t.pixelRatio?Math.round(t.screenHeight*t.pixelRatio):t.screenHeight},getScreenWidth:function(t){return t.pixelRatio?Math.round(t.screenWidth*t.pixelRatio):t.screenWidth},getOS:function(t){if(t){const e=t.toLowerCase();return-1!=e.indexOf("android")?`${gioGlobal.platformConfig.name}-Android`:-1!=e.indexOf("ios")?`${gioGlobal.platformConfig.name}-iOS`:t}},getOSV:t=>`${gioGlobal.platformConfig.name} ${t}`,isEmpty:t=>{for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},compareVersion(t,e){t=t.split("."),e=e.split(".");const i=Math.max(t.length,e.length);for(;i>t.length;)t.push("0");for(;i>e.length;)e.push("0");for(let n=0;i>n;n++){const i=parseInt(t[n]),o=parseInt(e[n]);if(i>o)return 1;if(o>i)return-1}return 0},queryParse(t){const e={};if(t){const i=t.split("&");for(const t of i){const i=t.split("="),n=i.length;2==n?e[i[0]]=i[1]:1==n&&i[0]&&(e[i[0]]="")}}return e},queryStringify:(t,...e)=>Object.keys(t).filter(t=>!e||!e.includes(t)).map(e=>`${e}=${t[e]}`).join("&"),clearShareQuery(t){if(!t)return;const e=Utils.queryParse(t);return delete e.shareId,delete e.contentType,Utils.queryStringify(e)}},isObject=t=>"[object Object]"===Object.prototype.toString.apply(t),splitPath=t=>{if(t){const e=t.indexOf("?");if(-1!==e){return[t.substring(0,e),t.substring(e+1)]}}return[t,""]},initGlobal=t=>{Object.defineProperty(Object.prototype,"gioGlobal",{get:()=>"quickApp"===t?global.__proto__:"my"===t?$global:global,configurable:!1,enumerable:!1})},isTaro3=()=>{let t=gioGlobal.vdsConfig.taro;return!!t.vue||(t&&t.taro&&(t=t.taro),!!t&&!t.createApp&&!!document.getElementById)},isTaro3Vue=()=>{return!!gioGlobal.vdsConfig.taro.vue},firstLowerCase=t=>t.replace(t[0],t[0].toLowerCase()),getDataByPath=(t,e)=>{if(!t)return t;const i=e.split(".");let n=t[i.shift()];for(let t=0,e=i.length;e>t;t++){const t=i.shift();if(!n)return n;n=n[t]}return n},getManualImpInfo=t=>{const e={eventId:void 0,properties:{}};try{if(t.hasOwnProperty("gioTrack")&&"object"==typeof t.gioTrack)return e.eventId=t.gioTrack.name,e.properties=t.gioTrack.properties,e;if(!t.gioImpTrack)return e;e.eventId=t.gioImpTrack;const i=/^gioTrack(.+)/,n=/^\w+$/;for(const o in t){let s;const r=o.match(i);if(r&&("track"===(s=firstLowerCase(r[1]))?e.eventId=t[o]:e.properties[s]=t[o]),!n.test(e.eventId)||10>parseInt(e.eventId[0]))throw e.eventId=null,Error()}}catch(t){console.warn("半打点IMP格式不正确, 事件名只能包含数字，字母和下划线，且不以数字开头, 请参考文档")}return e},stringifyVar=t=>{const e=t;for(const i in t)"string"!=typeof t[i]&&(e[i]=JSON.stringify(t[i]));return e},isString=t=>t&&"string"==typeof t&&t.constructor===String,getItem=t=>{if(!t||"object"!=typeof t)return null;if(t.id&&t.key){const e={id:"string"==typeof t.id?t.id:JSON.stringify(t.id),key:"string"==typeof t.key?t.key:JSON.stringify(t.key)};return t.attributes&&(e.attributes=t.attributes),e}return null},defineInfoHook=t=>(function(){try{const e="function"!=typeof t?{}:t.apply(this,arguments);return e instanceof Promise?e:Promise.resolve(e)}catch(t){return Promise.reject(t)}}),truth=t=>t||void 0,normalPath=t=>/^\//.test(t)?t:"/"+t,SUPPORT_IGNORED_FIELDS=["networkState","screenHeight","screenWidth","deviceBrand","deviceModel","deviceType"],getValidIgnoreFields=t=>t?(t=Array.isArray(t)?t:[t]).filter(t=>SUPPORT_IGNORED_FIELDS.includes(t)):null,omit=(t,...e)=>{const i={};return Object.keys(t).forEach(n=>{-1==e.indexOf(n)&&(i[n]=t[n])}),i};let queryShareId=void 0;function buildShareQuery(t,e,i){const n={gioShareId:Utils.guid(),suid:e},o=Object.assign(Utils.queryParse(t),n),s=o.contentType||i.contentType,r=o.contentId||i.contentId;return s&&(n.contentType=s),r&&(n.contentId=r),queryShareId&&(n.gioPreShareId=queryShareId),[Utils.queryStringify(o),n]}function updateShareResult(t,e,i){const n=t.growingio;if(n&&n.vdsConfig.followShare){const o=n.info.uid;i||(i={}),i.title||(i.title=t.info.getPageTitle(e));const s=t.currentPage,[r,a]=splitPath(i.path),[g,c]=buildShareQuery(a||i.query,o,i);i.query=g,i.path=normalPath((r||s.path)+"?"+g),i.attributes=c}return i}function onPageShow(t){const e=Utils.queryParse(t.query);e.gioShareId&&(queryShareId=e.gioShareId)}let eventStopMap={};function isPropagationStopped(t){const e=t.target.id,i=t.currentTarget.id;return!(!i||i===e)&&!!eventStopMap[e]}function noEvent(t){return!t||!t.target||!t.type}function octopusNeedHook(t,e){if(!noEvent(e))return t.includes(e.type)&&!isPropagationStopped(e)}function octopusHookEventAfter(t){if(noEvent(t))return;t.isPropagationStopped&&(eventStopMap[t.target.id]=t.isPropagationStopped())}const setShareResult=(t,e,i)=>updateShareResult(VdsInstrumentAgent.observer,t,i),isPageShare=t=>t==gioGlobal.platformConfig.lisiteners.page.shareApp||t==gioGlobal.platformConfig.lisiteners.page.shareTime,getConfigByPath=t=>{return getDataByPath(VdsInstrumentAgent.observer.growingio,`vdsConfig.${t}`)};let taroVuePrevEvent=void 0;function getValidEvent(t){const e=(null===t||void 0===t?void 0:t[0])?t[0]:taroVuePrevEvent;return e&&e.type&&isObject(e.target)&&-1!==VdsInstrumentAgent.actionEventTypes.indexOf(e.type)?e:taroVuePrevEvent}const VdsInstrumentAgent={defaultPageCallbacks:{},defaultAppCallbacks:{},appHandlers:null,pageHandlers:null,actionEventTypes:null,originalPage:null,originalApp:null,originalComponent:null,originalBehavior:null,observer:null,hook:function(t,e,i){return function(){const n=i||this;let o;const s=getValidEvent(arguments),r=getDataByPath(VdsInstrumentAgent.observer.growingio,`vdsConfig.${"octopus"}`);const a=()=>{if(s&&(s.currentTarget||s.target)&&-1!=VdsInstrumentAgent.actionEventTypes.indexOf(s.type)&&(i||!isTaro3()))try{VdsInstrumentAgent.observer.actionListener(s,t)}catch(t){console.error(t)}};r||a();const g=gioGlobal.platformConfig.lisiteners.app,c=gioGlobal.platformConfig.lisiteners.page;if(gioGlobal.vdsConfig.taro.vue&&s&&(taroVuePrevEvent=s),n._growing_app_&&t!==g.appShow?o=e.apply(this,arguments):n._growing_page_&&-1===[c.pageShow,c.pageClose,c.pageLoad,c.pageHide,c.tabTap].indexOf(t)?o=e.apply(this,arguments):n._growing_app_||n._growing_page_||(o=e.apply(this,arguments)),taroVuePrevEvent=void 0,n._growing_app_){if(-1!==VdsInstrumentAgent.appHandlers.indexOf(t))try{VdsInstrumentAgent.defaultAppCallbacks[t].apply(this,arguments)}catch(t){console.error(t)}t===g.appShow&&(o=e.apply(this,arguments))}if(n._growing_page_&&-1!==VdsInstrumentAgent.pageHandlers.indexOf(t)){c.shareTime==t?o=setShareResult(n,0,o):c.shareApp==t&&(o=setShareResult(n,0,o));const i=Array.prototype.slice.call(arguments);o&&i.push(o);try{VdsInstrumentAgent.defaultPageCallbacks[t].apply(n,i)}catch(t){console.error(t)}-1!==[c.pageShow,c.pageClose,c.pageLoad,c.pageHide,c.tabTap].indexOf(t)&&(o=e.apply(this,arguments))}return r&&octopusNeedHook(VdsInstrumentAgent.actionEventTypes,s)&&a(),octopusHookEventAfter(s),o}},hookComponent:function(t,e){return function(){const i=arguments?arguments[0]:void 0;if(i&&(i.currentTarget||i.target)&&-1!=VdsInstrumentAgent.actionEventTypes.indexOf(i.type))try{VdsInstrumentAgent.observer.actionListener(i,t)}catch(t){console.error(t)}return e.apply(this,arguments)}},hookPage:(t,e)=>(function(){let i=e.apply(this,arguments);t===gioGlobal.platformConfig.lisiteners.page.shareTime?i=setShareResult(this,0,i):t===gioGlobal.platformConfig.lisiteners.page.shareApp&&(i=setShareResult(this,0,i));const n=Array.prototype.slice.call(arguments);return i&&n.push(i),VdsInstrumentAgent.observer.pageListener(this,t,n),i}),instrument:function(t){const e={},i=i=>{e[i]="function"==typeof t[i]&&"constructor"!==i?this.hook(i,t[i]):t[i]};return Object.getOwnPropertyNames(t).forEach(i),t.__proto__!==Object.prototype&&Object.getOwnPropertyNames(t.__proto__).forEach(i),e._growing_app_&&VdsInstrumentAgent.appHandlers.map(function(t){e[t]||(e[t]=VdsInstrumentAgent.defaultAppCallbacks[t])}),e._growing_page_&&VdsInstrumentAgent.pageHandlers.map(function(t){e[t]||t===gioGlobal.platformConfig.lisiteners.page.shareApp||t===gioGlobal.platformConfig.lisiteners.page.shareTime||(e[t]=VdsInstrumentAgent.defaultPageCallbacks[t])}),e},instrumentPageComponent:function(t){if(t)return VdsInstrumentAgent.pageHandlers.map(function(e){if("function"==typeof t[e])t[e]=VdsInstrumentAgent.hookPage(e,t[e]);else if(e!==gioGlobal.platformConfig.lisiteners.page.shareApp&&e!==gioGlobal.platformConfig.lisiteners.page.shareTime){const i=e;t[e]=function(){VdsInstrumentAgent.observer.pageListener(this,i,arguments)}}}),t},instrumentComponent:function(t){const e=t._growing_aspage_,i=t.methods||{};return Object.entries(i).forEach(([t,n])=>{"function"==typeof n&&(i[t]=(t=>-1!=VdsInstrumentAgent.pageHandlers.indexOf(t))(t)?e?this.hookPage(t,n):n:this.hookComponent(t,n))}),e&&VdsInstrumentAgent.pageHandlers.map(t=>{if(!i[t]&&!isPageShare(t)){const e=t;i[t]=function(){VdsInstrumentAgent.observer.pageListener(this,e,arguments)}}}),t.methods=i,t},GrowingPage:function(t){return t._growing_page_=!0,VdsInstrumentAgent.originalPage(VdsInstrumentAgent.instrument(t))},GrowingComponent:function(t){return t._growing_aspage_=gioGlobal.vdsConfig.comAsPage,VdsInstrumentAgent.originalComponent(VdsInstrumentAgent.instrumentComponent(t))},GrowingBehavior:function(t){return VdsInstrumentAgent.originalBehavior(VdsInstrumentAgent.instrumentComponent(t))},GrowingApp:function(t){return t._growing_app_=!0,VdsInstrumentAgent.originalApp(VdsInstrumentAgent.instrument(t))},initPlatformInfo(t){VdsInstrumentAgent.appHandlers=t.appHandlers,VdsInstrumentAgent.pageHandlers=t.pageHandlers,VdsInstrumentAgent.actionEventTypes=t.actionEventTypes,VdsInstrumentAgent.originalApp=t.originalApp,VdsInstrumentAgent.originalPage=t.originalPage,VdsInstrumentAgent.originalComponent=t.originalComponent,VdsInstrumentAgent.originalBehavior=t.originalBehavior},initInstrument:function(t){if(VdsInstrumentAgent.initPlatformInfo(gioGlobal.platformConfig),VdsInstrumentAgent.observer=t,VdsInstrumentAgent.pageHandlers.forEach(function(t){const e=t;VdsInstrumentAgent.defaultPageCallbacks[t]=function(){VdsInstrumentAgent.observer.pageListener(this,e,arguments)}}),VdsInstrumentAgent.appHandlers.forEach(function(t){const e=t;VdsInstrumentAgent.defaultAppCallbacks[t]=function(){VdsInstrumentAgent.observer.appListener(this,e,arguments)}}),gioGlobal.platformConfig.canHook){const t=gioGlobal.platformConfig.hooks;if(t.App&&!gioGlobal.growingAppInited){if(App=function(){return VdsInstrumentAgent.GrowingApp(arguments[0])},"swan"===gioGlobal.gio__platform)for(const t in VdsInstrumentAgent.originalApp)App[t]=VdsInstrumentAgent.originalApp[t];gioGlobal.growingAppInited=!0}if(t.Page&&!gioGlobal.growingPageInited){if(Page=function(){return VdsInstrumentAgent.GrowingPage(arguments[0])},"swan"===gioGlobal.gio__platform)for(const t in VdsInstrumentAgent.originalPage)Page[t]=VdsInstrumentAgent.originalPage[t];gioGlobal.growingPageInited=!0}t.Component&&!gioGlobal.growingComponentInited&&(Component=function(){return VdsInstrumentAgent.GrowingComponent(arguments[0])},gioGlobal.growingComponentInited=!0),t.Behavior&&!gioGlobal.growingBehaviorInited&&(Behavior=function(){return VdsInstrumentAgent.GrowingBehavior(arguments[0])},gioGlobal.growingBehaviorInited=!0)}gioGlobal.GioPage=VdsInstrumentAgent.GrowingPage,gioGlobal.GioApp=VdsInstrumentAgent.GrowingApp,gioGlobal.GioComponent=VdsInstrumentAgent.GrowingComponent,gioGlobal.GioBehavior=VdsInstrumentAgent.GrowingBehavior,gioGlobal.trackApp=function(){const t=arguments[0];return t._growing_app_=!0,VdsInstrumentAgent.instrument(t)},gioGlobal.trackPage=function(){const t=arguments[0];return t._growing_page_=!0,VdsInstrumentAgent.instrument(t)},gioGlobal.trackComponent=function(){return VdsInstrumentAgent.instrument(arguments[0])},gioGlobal.trackBehavior=function(){return VdsInstrumentAgent.instrument(arguments[0])}}};if(!Object.hasOwnProperty("getOwnPropertyDescriptors")){let t;t="object"==typeof Reflect&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:"function"==typeof Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(e){return t(e).reduce((t,i)=>Object.defineProperty(t,i,{configurable:!0,enumerable:!0,writable:!0,value:Object.getOwnPropertyDescriptor(e,i)}),{})}})}Object.entries||(Object.entries=function(t){for(var e=Object.keys(t),i=e.length,n=Array(i);i--;)n[i]=[e[i],t[e[i]]];return n});class BaseObserver{constructor(t){this.growingio=t,this.esid=0,this.info=t.info}setUserAttributes(){throw Error("this a interface function")}setUserId(){throw Error("this a interface function")}clearUserId(){throw Error("this a interface function")}sendVisitEvent(){throw Error("this a interface function")}track(){throw Error("this a interface function")}_sendEvent(){throw Error("this a interface function")}}const eventTypeMap={tap:["tap","click"],longtap:["longtap"],input:["input"],blur:["change","blur"],submit:["submit"],focus:["focus"]},fnExpRE=/^function[^(]*\([^)]+\).*[^.]+\.([^(]+)\(.*/;function getComKey(t){return t&&t.$attrs?t.$attrs.mpcomid:"0"}function isVmKeyMatchedCompkey(t,e,i){return!(!t||!e)&&(e===t||0===e.indexOf(t+i))}function getVM(t,e,i){void 0===e&&(e=[]);var n=e.slice(1);if(!n.length)return t;var o=n.join(i),s="";return n.reduce(function(t){for(var e=t.$children.length,n=0;e>n;n++){var r=t.$children[n],a=getComKey(r);if(s&&(a=s+i+a),isVmKeyMatchedCompkey(a,o,i))return s=a,t=r}return t},t)}function getHandle(t,e,i){void 0===i&&(i=[]);var n=[];if(!t||!t.tag)return n;var o=t||{},s=o.data;void 0===s&&(s={});var r=o.children;void 0===r&&(r=[]);var a=o.componentInstance;a?Object.keys(a.$slots).forEach(function(t){var o=a.$slots[t];(Array.isArray(o)?o:[o]).forEach(function(t){n=n.concat(getHandle(t,e,i))})}):r.forEach(function(t){n=n.concat(getHandle(t,e,i))});var g=s.attrs,c=s.on;return g&&c&&g.eventid===e&&i.forEach(function(t){var e=c[t];"function"==typeof e?n.push(e):Array.isArray(e)&&(n=n.concat(e))}),n}const ONCE="~",CUSTOM="^";function isMatchEventType(t,e){return t===e||"regionchange"===e&&("begin"===t||"end"===t)}class VueProxy{constructor(t){this.vueVM=t}getHandle(t){var e=t.type,i=t.target;void 0===i&&(i={});var n=(t.currentTarget||i).dataset;void 0===n&&(n={});var o=n.comkey;void 0===o&&(o="");var s=n.eventid;const r=-1!==o.indexOf("_")?"_":",";var a=getVM(this.vueVM,o.split(r),r);if(a){var g=getHandle(a._vnode,s,eventTypeMap[e]||[e]);if(g.length){var c=g[0];if(c.isProxied)return c.proxiedName;try{var u=(""+c).replace("\n","");if(u.match(fnExpRE)){var h=fnExpRE.exec(u);if(h&&h.length>1)return h[1]}}catch(t){}return c.name}}}handleEvent(t){const e=t.type;let i;const n=(t.currentTarget||t.target).dataset;return(n.eventOpts||n["event-opts"]).forEach(t=>{let n=t[0];const o=t[1];n=(n=n.charAt(0)===CUSTOM?n.slice(1):n).charAt(0)===ONCE?n.slice(1):n,o&&isMatchEventType(e,n)&&o.forEach(t=>{i=t[0]})}),i}}function validVar(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)&&Object.keys(t).length>0}const sdkVersion="3.7.3",platformConfig={wx:{name:"Weixin",path:"./weixin"},qq:{name:"QQ",path:"./qq"},my:{name:"Alipay",path:"./alipay"},swan:{name:"Baidu",path:"./baidu"},tt:{name:"Bytedance",path:"./bytedance"},quickApp:{name:"Quickapp",path:"./quickApp"},frame:{name:"Frame",path:"./multipleFrame"}},Config=Object.assign(Object.assign({},platformConfig.wx),{platform:"MinP",scnPrefix:"",appHandlers:["onShow","onHide","onError"],pageHandlers:["onLoad","onShow","onShareAppMessage","onShareTimeline","onTabItemTap","onHide","onUnload"],actionEventTypes:["onclick","tap","longpress","blur","change","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:App,originalPage:Page,originalComponent:Component,originalBehavior:Behavior,canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},lisiteners:{app:{appShow:"onShow",appClose:"onHide",appError:"onError"},page:{pageLoad:"onLoad",pageShow:"onShow",pageHide:"onHide",pageClose:"onUnload",tabTap:"onTabItemTap",shareApp:"onShareAppMessage",shareTime:"onShareTimeline"},actions:{click:["onclick","tap","longpress","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}});var platformConfig$1=Object.assign(Object.assign({},Config),{sdkVer:"3.7.3"});function EventEmitter(){}var proto=EventEmitter.prototype,originalGlobalValue=exports.EventEmitter;function indexOfListener(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}function alias(t){return function(){return this[t].apply(this,arguments)}}function isValidListener(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&isValidListener(t.listener)}proto.getListeners=function(t){var e,i,n=this._getEvents();if(t instanceof RegExp)for(i in e={},n)n.hasOwnProperty(i)&&t.test(i)&&(e[i]=n[i]);else e=n[t]||(n[t]=[]);return e},proto.flattenListeners=function(t){var e,i=[];for(e=0;t.length>e;e+=1)i.push(t[e].listener);return i},proto.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&((e={})[t]=i),e||i},proto.addListener=function(t,e){if(!isValidListener(e))throw new TypeError("listener must be a function");var i,n=this.getListenersAsObject(t),o="object"==typeof e;for(i in n)n.hasOwnProperty(i)&&-1===indexOfListener(n[i],e)&&n[i].push(o?e:{listener:e,once:!1});return this},proto.on=alias("addListener"),proto.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},proto.once=alias("addOnceListener"),proto.defineEvent=function(t){return this.getListeners(t),this},proto.defineEvents=function(t){for(var e=0;t.length>e;e+=1)this.defineEvent(t[e]);return this},proto.removeListener=function(t,e){var i,n,o=this.getListenersAsObject(t);for(n in o)o.hasOwnProperty(n)&&-1!==(i=indexOfListener(o[n],e))&&o[n].splice(i,1);return this},proto.off=alias("removeListener"),proto.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},proto.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},proto.manipulateListeners=function(t,e,i){var n,o,s=t?this.removeListener:this.addListener,r=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(n=i.length;n--;)s.call(this,e,i[n]);else for(n in e)e.hasOwnProperty(n)&&(o=e[n])&&("function"==typeof o?s.call(this,n,o):r.call(this,n,o));return this},proto.removeEvent=function(t){var e,i=typeof t,n=this._getEvents();if("string"===i)delete n[t];else if(t instanceof RegExp)for(e in n)n.hasOwnProperty(e)&&t.test(e)&&delete n[e];else delete this._events;return this},proto.removeAllListeners=alias("removeEvent"),proto.emitEvent=function(t,e){var i,n,o,s,r=this.getListenersAsObject(t);for(s in r)if(r.hasOwnProperty(s))for(i=r[s].slice(0),o=0;i.length>o;o++)!0===(n=i[o]).once&&this.removeListener(t,n.listener),n.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(t,n.listener);return this},proto.trigger=alias("emitEvent"),proto.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},proto.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},proto._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},proto._getEvents=function(){return this._events||(this._events={})},EventEmitter.noConflict=function(){return exports.EventEmitter=originalGlobalValue,EventEmitter};const gioEmitter=new EventEmitter;class Page$1{constructor(){this.queries={},this.pvar={}}touch(t){this.path=t.route||t.__route__,this.time=Date.now(),this.query=this.queries[t.route]?this.queries[t.route]:void 0}addQuery(t,e){this.queries[t.route]=e?this._getQuery(e):null}_getQuery(t){return Object.keys(t||{}).filter(t=>"wxShoppingListScene"!==t).map(e=>`${e}=${t[e]}`).join("&")}touchRelatedPvarData(t){const e=`${t.p}?${t.q}`;this.pvar[e]?this.pvar[e].push(t):this.pvar[e]=[t]}equalsPage(t){return t.p==this.path&&t.q==this.query}}class Observer extends BaseObserver{constructor(t){super(t),this.growingio=t,this.info=t.info,this.currentPage=new Page$1,this._sessionId=null,this.uploadingMessages=[],this.isGettingUid=!1,this.lastSentTime=null,this.lastScene=null,this.keepAlive=3e5,this.scene=void 0,this.currentScene=void 0,this.esid=0===this.info.esid?1:this.info.esid,this.uid=this.info.uid,this.gioId=this.info.gioId,this.path=null,this.query=null,this.visitEvent={context:void 0},this.isPauseSession=!1,this.lastPageEvent=null,this.cdpObserver=!0,this.vstSended=!1}getGioInfo(){const t=this.info.uid,e=this.getUserId(),i=this.info.userKey||"",n=`giou=${t}&gios=${this.sessionId}&giocs1=${e}&gioid=${this.info.gioId}&gioprojectid=${this.growingio.vdsConfig.projectId}&gioappid=${this.growingio.vdsConfig.appId}&gioplatform=${gioGlobal.platformConfig.platform}&giodatasourceid=${this.growingio.vdsConfig.dataSourceId}`;return getDataByPath(this.growingio,"vdsConfig.enableIdMapping")?`${n}&giouserkey=${i}`:n}appListener(t,e,i){"onShow"===e?(this.growingio._getOption(i[0]),this.growingio.send()):"onHide"===e&&(this.info.esid=this.esid,this.lastSentTime=+Date.now(),this.sendCloseEvent())}pageListener(t,e,i){const n=gioGlobal.platformConfig.lisiteners.page;if(t.route||this.info.getPagePath(t),this.growingio.vdsConfig.debug&&console.log("Page.",t.route,"#",e,Date.now()),e===n.pageShow){const e=getDataByPath(t,"$page.query");Utils.isEmpty(e)||"quickApp"!==gioGlobal.gio__platform||this.currentPage.addQuery(t,e),this.isPauseSession?this.isPauseSession=!1:(this.currentPage.touch(t),setTimeout(()=>{this.sendPage(t)},300)),onPageShow(this.currentPage)}else if(e===n.pageLoad){const e=i[0];Utils.isEmpty(e)||"quickApp"===gioGlobal.gio__platform||this.currentPage.addQuery(t,e)}else if(e===n.shareApp||e===n.shareTime){let n=null,o=null;2>i.length?1===i.length&&(i[0].from?n=i[0]:i[0].title&&(o=i[0])):(n=i[0],o=i[1]),this.isPauseSession=!0,this.sendPageShare(t,n,o,e)}else if("onTabItemTap"===e){this.sendTabClick(i[0])}}actionListener(t,e){if(getDataByPath(t,"currentTarget.dataset.growingIgnore")||getDataByPath(t,"target.dataset.growingIgnore"))return;const i=gioGlobal.platformConfig.lisiteners.actions;if("_cmlEventProxy"!==e){if("handleProxy"===e&&this.growingio.vueRootVMs&&this.growingio.vueRootVMs[this.currentPage.path]){const i=new VueProxy(this.growingio.vueRootVMs[this.currentPage.path]).getHandle(t);i&&(e=i)}if("__e"===e&&this.growingio.vueRootVMs&&this.growingio.vueRootVMs[this.currentPage.path]){const i=new VueProxy(this.growingio.vueRootVMs[this.currentPage.path]).handleEvent(t);i&&(e=i)}if("_proxy"===e&&this.growingio.wepyRootVMs){const i=t.currentTarget.dataset.wpyEvt,n=t.type;getDataByPath(this,`growingio.wepyRootVMs.${i}.${n}`)&&(e=this.growingio.wepyRootVMs[i][n])}getDataByPath(this,`growingio.taroRootVMs.${e}`)&&(e=this.growingio.taroRootVMs[e]),this.growingio.vdsConfig.debug&&console.log("Click on ",e,Date.now()),-1!==i.click.indexOf(t.type)?this.sendClick(t,e):-1!==i.change.indexOf(t.type)?this.sendChange(t,e):-1!==i.submit.indexOf(t.type)&&this.sendSubmit(t,e),"getuserinfo"===t.type&&getDataByPath(t,"detail.userInfo")}}get sessionId(){return null===this._sessionId&&(this._sessionId=Utils.guid()),this._sessionId}getUserId(){return this.info.userId||this.info.gioId}setUserId(t,e){if(null==t||""===t)return this.clearUserId();const i=t+"",n=this.growingio.info.gioId;i&&100>i.length&&(this.info.userId=i,this.info.gioId=i,this.info.userKey=e,gioEmitter.emitEvent("setCs1",[i]),n&&n!=i&&this.sendVisitEvent(this.growingio.vdsConfig.getLocationType,!0))}clearUserId(){this.info.userId=null,this.info.userKey=null,gioEmitter.emitEvent("clearCs1")}sendPage(t){const e=this.lastPageEvent?this.lastPageEvent.context.page.path:void 0,i={page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,title:this.info.getPageTitle(t)},referrer:{page:e||`scn:${this.currentScene?this.currentScene:"NA"}`}},n={type:"PAGE",sendTime:this.currentPage.time,context:Object.assign(Object.assign({},this.visitEvent.context),i),session:this.sessionId,version:this.growingio.vdsConfig.sdkVer};this._sendEvent(n),this.lastPageEvent=n}setPlatformProfile(t){let e="$basic_";switch(platformConfig$1.platform){case"alip":e="$alipay_";break;case"MinP":e="$wechat_"}const i=Object.entries(t).reduce((t,[i,n])=>Object.assign(Object.assign({},t),{[e+i]:n}),{});this.setUserAttributes(i)}setUserAttributes(t){if(validVar(t)){const e={platform:platformConfig$1.platform,session:this.sessionId,attributes:stringifyVar(t),context:this.visitEvent.context};this._sendEvent(e)}}track(t,e,i){if("string"!=typeof t||null===t||void 0===t||0===t.length||!t.match(/^\w+$/)||10>parseInt(t[0]))return void console.warn("埋点格式不正确, 事件名只能包含数字，字母和下划线，且不以数字开头, 请参考文档");const n=this.info.getCurrentPage(),o={type:"CUSTOM_EVENT",eventKey:t,context:Object.assign(Object.assign({},this.visitEvent.context),{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.path||this.info.getPagePath(),query:this.currentPage.query||this.currentPage._getQuery(this.query),title:this.info.getPageTitle(n),time:this.currentPage.time},referrer:{from:`scn:${this.currentScene?this.currentScene:"NA"}`},network:{type:void 0}}),session:this.sessionId};validVar(e)&&(o.attributes=e);const s=getItem(i);s&&(o.item=s),this.info.getNetworkType().then(t=>{t&&(o.context.network.type=t.networkType),this._sendEvent(o)})}sendCloseEvent(){if(this.isPauseSession)return;const t=Object.assign(Object.assign({},this.visitEvent),{type:"VISIT_CLOSED"});this._sendEvent(t)}sendPageShare(t,e,i,n="onShareAppMessage"){if(!this.growingio.vdsConfig.followShare)return;const o={type:"CUSTOM_EVENT",eventKey:n,attributes:{from:e?e.from:void 0,target:e&&e.target?e.target.id:void 0},context:Object.assign(Object.assign({},this.visitEvent.context),{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,time:this.currentPage.time}}),session:this.sessionId,version:this.growingio.vdsConfig.sdkVer};i&&(o.attributes=Object.assign(Object.assign(Object.assign({},o.attributes),{title:i.title,path:i.path?decodeURI(i.path):void 0}),i.attributes)),this._sendEvent(o)}sendTabClick(t){const e={type:"VIEW_CLICK",session:this.sessionId,context:Object.assign(Object.assign({},this.visitEvent.context),{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,time:this.currentPage.time}}),elements:[{x:"#onTabItemTap",v:t.text,idx:t.index,h:"string"==typeof t.pagePath?t.pagePath:JSON.stringify(t.pagePath)}]};this._sendEvent(e)}sendClick(t,e){const i={type:"VIEW_CLICK",session:this.sessionId,context:Object.assign(Object.assign({},this.visitEvent.context),{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,time:this.currentPage.time}})},n=t.currentTarget||t.target;let o=n.id;(!o||"swan"===gioGlobal.gio__platform&&/^_[0-9a-f]+/.test(o)||isTaro3()&&/^_n_[0-9]+$/.test(o))&&(o="");const s={x:`${o}#${e}`};n.dataset.title&&(s.v=n.dataset.title),n.dataset.src&&(s.h=n.dataset.src),void 0!==n.dataset.index&&(s.idx=/^[\d]+$/.test(n.dataset.index)?parseInt(n.dataset.index):-1),i.elements=[s],this._sendEvent(i)}sendSubmit(t,e){const i={type:"FORM_SUBMIT",session:this.sessionId,context:Object.assign(Object.assign({},this.visitEvent.context),{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,time:this.currentPage.time}})};let n=(t.currentTarget||t.target).id;(!n||"swan"===gioGlobal.gio__platform&&/^_[0-9a-f]+/.test(n)||isTaro3()&&/^_n_[0-9]+$/.test(n))&&(n=""),i.elements=[{x:`${n}#${e}`}],this._sendEvent(i)}sendChange(t,e){const i={type:"VIEW_CHANGE",session:this.sessionId,context:Object.assign(Object.assign({},this.visitEvent.context),{page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.currentPage.path,query:this.currentPage.query,time:this.currentPage.time}})},n=t.currentTarget||t.target;let o=n.id;(!o||"swan"===gioGlobal.gio__platform&&/^_[0-9a-f]+/.test(o)||isTaro3()&&/^_n_[0-9]+$/.test(o))&&(o="");const s={x:`${o}#${e}`};let r=getDataByPath(t,"detail.value")||getDataByPath(t,"target.attr.value");n.dataset&&(n.dataset.growingTrack||n.dataset.growingtrack)&&("boolean"==typeof r||r&&0!==r.length)&&("[object Array]"===Object.prototype.toString.call(r)?(r=r.join(","))&&(s.v=r):s.v=r),"change"===t.type&&"autoplay"===getDataByPath(t,"detail.source")||(i.elements=[s],this._sendEvent(i))}identify(t){void 0!==t&&null!==t&&0!==t.length&&this.growingio.login(t)}sendVisitEvent(t,e){if(!e){if(this.isPauseSession)return;const t=Date.now();if(this.keepAlive>t-this.lastSentTime&&this.lastScene===this.currentScene)return;this._sessionId=null}const i=this.info.getCurrentPage(),n=this,o=this.info.getSystemInfo(),s=this.info.getNetworkType();Promise.all([o,s]).then(([e,o])=>{const s=e||{},r={type:"VISIT",version:this.growingio.vdsConfig.sdkVer,context:{app:{id:this.growingio.vdsConfig.appId,version:this.growingio.vdsConfig.appVer,channel:`scn:${this.currentScene?this.currentScene:"NA"}`},screen:{width:Utils.getScreenWidth(s),height:Utils.getScreenHeight(s)},device:{brand:s.brand,model:s.model,platform:platformConfig$1.platform},operationSystem:{name:Utils.getOS(s.platform),version:platformConfig$1.name+" "+s.version},page:{domain:this.growingio.vdsConfig.appId||this.info.getAppId(),path:this.path||this.info.getPagePath(),query:truth(this.currentPage._getQuery(this.query)),title:truth(this.info.getPageTitle(i))},locale:{language:s.language},network:{type:void 0},location:{latitude:void 0,longitude:void 0}},session:this.sessionId};n.visitEvent=r,o&&(r.context.network.type=o.networkType,this._sendEvent(r),this.growingio.vdsConfig.getLocation.autoGet&&(t&&-1!==["wgs84","gcj02",0,1,2].indexOf(t)||(t="my"===gioGlobal.gio__platform?0:"wgs84"),this.info.getLocation(t).then(t=>{if(t){const e=JSON.parse(JSON.stringify(r));e.context.location.latitude=t.latitude,e.context.location.longitude=t.longitude,this._sendEvent(e),n.visitEvent=e}})))})}_sendEvent(t){if(!this.growingio.vdsConfig.dataCollect)return void(this.vstSended||"VISIT"!==t.type||this.growingio.uploadingMessages.push(t));if(this.growingio.vdsConfig.autotrack||!["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT"].includes(t.type)){if(t.version=this.growingio.vdsConfig.sdkVer,t.projectKey=this.growingio.vdsConfig.projectId,t.dataSourceId=this.growingio.vdsConfig.dataSourceId,t.anonymousId=this.info.uid,t.timestamp=+Date.now(),this.lastSentTime=+Date.now(),this.lastScene=this.currentScene,t.esid=this.esid,this.info.userKey&&(t.userKey=this.info.userKey),this.info.userId&&(t.userId=this.info.userId),this.info.gioId&&(t.gioId=this.info.gioId),this.uid&&this.gioId)this.growingio.upload(t);else if(this.isGettingUid)this.uploadingMessages.push(t);else{this.isGettingUid=!0;const e=this.info.getStorage(this.info.uidKey),i=this.info.getStorage(this.info.gioIdKey);Promise.all([e,i]).then(([e,i])=>{const n=this.info.uid||e||Utils.guid();for(i&&(this.info.gioId=this.info.gioId||i,t.gioId=t.gioId||i),this.info.uid=n,t.anonymousId=n,this.isGettingUid=!1,this.growingio.upload(t);0!==this.uploadingMessages.length;){const t=this.uploadingMessages.shift();i&&(t.gioId=t.gioId||i),t.anonymousId=t.anonymousId||n,this.growingio.upload(t)}})}this.esid++,this.growingio.vdsConfig.canHide&&(this.info.esid=this.esid)}}}const f=String.fromCharCode,LZString={compressToUTF16:function(t){return null==t?"":LZString._compress(t,15,function(t){return f(t+32)})+" "},_compress:function(t,e,i){if(null==t)return"";var n,o,s,r={},a={},g="",c="",u="",h=2,p=3,l=2,d=[],f=0,m=0;for(s=0;t.length>s;s+=1)if(g=t.charAt(s),Object.prototype.hasOwnProperty.call(r,g)||(r[g]=p++,a[g]=!0),Object.prototype.hasOwnProperty.call(r,c=u+g))u=c;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(256>u.charCodeAt(0)){for(n=0;l>n;n++)f<<=1,m==e-1?(m=0,d.push(i(f)),f=0):m++;for(o=u.charCodeAt(0),n=0;8>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1}else{for(o=1,n=0;l>n;n++)f=f<<1|o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o=0;for(o=u.charCodeAt(0),n=0;16>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1}0==--h&&(h=Math.pow(2,l),l++),delete a[u]}else for(o=r[u],n=0;l>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1;0==--h&&(h=Math.pow(2,l),l++),r[c]=p++,u=g+""}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(256>u.charCodeAt(0)){for(n=0;l>n;n++)f<<=1,m==e-1?(m=0,d.push(i(f)),f=0):m++;for(o=u.charCodeAt(0),n=0;8>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1}else{for(o=1,n=0;l>n;n++)f=f<<1|o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o=0;for(o=u.charCodeAt(0),n=0;16>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1}0==--h&&(h=Math.pow(2,l),l++),delete a[u]}else for(o=r[u],n=0;l>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1;0==--h&&(h=Math.pow(2,l),l++)}for(o=2,n=0;l>n;n++)f=f<<1|1&o,m==e-1?(m=0,d.push(i(f)),f=0):m++,o>>=1;for(;;){if(f<<=1,m==e-1){d.push(i(f));break}m++}return d.join("")}};class Uploader{constructor(t){this.growingio=t,this.maxRequests=3,this.requestCount=0,this.timeout=5e3,this.messageQueue=[],this.uploadingQueue=[],this.uploadTimer=null,this.projectId=this.growingio.vdsConfig.projectId,this.appId=this.growingio.vdsConfig.appId,this.host=this.growingio.vdsConfig.host,this.compress=this.growingio.vdsConfig.compress,this.url=`${this.host}/projects/${this.projectId}/apps/${this.appId}/collect`}upload(t){this.messageQueue.push(t);const e=this.messageQueue.length;e>100&&(this.messageQueue=this.messageQueue.slice(e-100)),this.uploadTimer||(this.uploadTimer=setTimeout(()=>{this._flush(),this.uploadTimer=null},1e3))}forceFlush(){this.uploadTimer&&(clearTimeout(this.uploadTimer),this.uploadTimer=null),this._flush()}_flush(){if(this.requestCount>=this.maxRequests)return;const t=()=>{this.messageQueue.length>0&&this._flush()};if(this.uploadingQueue=this.messageQueue.slice(),this.messageQueue=[],this.uploadingQueue.length>0){this.uploadingQueue.find(t=>"vst"===t.t||"VISIT"===t.eventType)&&(this.growingio.observer.vstSended=!0),this.requestCount++;let e=this.uploadingQueue;const i={"content-type":"application/json"};this.compress&&(e=LZString.compressToUTF16(JSON.stringify(e)),i["X-Compress-Codec"]="1"),this.growingio.info.request({url:`${this.url}?stm=${Date.now()}`,method:"POST",header:i,data:e,timeout:this.timeout,success:()=>{this.requestCount--,t()},fail:(e=>i=>{this.requestCount--,204!==i.status?this.messageQueue=e.concat(this.messageQueue):t()})(this.uploadingQueue)})}}}class CdpUploader extends Uploader{constructor(t){super(t),this.growingio=t,this.url=`${this.growingio.vdsConfig.scheme}${this.host}/v3/projects/${this.projectId}/collect`}}class Info{constructor(t){this.growing=t,this._uid=void 0,this._esid=void 0,this._gioId=void 0,this._userId=void 0,this._systemInfo=null,this.uidKey="_growing_uid_",this.esidKey="_growing_esid_",this.gioIdKey="_growing_gioId_",this.userIdKey="_growing_userId_",this.userKeyKey="_growing_userKey_",this.platform=gioGlobal.platformConfig.platform,this.sdkVer=gioGlobal.platformConfig.sdkVer,this.scnPrefix=gioGlobal.platformConfig.scnPrefix,"quickapp"!==gioGlobal.platformConfig.platform&&this.initUserInfo()}get enableIdMapping(){return getDataByPath(this.growing,"vdsConfig.enableIdMapping")}set esid(t){this._esid=t,this.setStorage(this.esidKey,this._esid)}get esid(){return this._esid}set uid(t){this._uid=t,this.setStorage(this.uidKey,this._uid)}get uid(){return this._uid}set gioId(t){this._gioId=t,this.setStorage(this.gioIdKey,this._gioId)}get userKey(){if(this.enableIdMapping)return this._userKey}set userKey(t){this.enableIdMapping&&(this._userKey=t,this.setStorage(this.userKeyKey,this._userKey))}get userId(){return this._userId}set userId(t){this._userId=t,this.setStorage(this.userIdKey,this._userId)}get gioId(){return this._gioId}get systemInfo(){return this._systemInfo}initUserInfo(){this.uid=this.getStorageSync(this.uidKey)||Utils.guid(),this.esid=+this.getStorageSync(this.esidKey),this.gioId=this.getStorageSync(this.gioIdKey),this._userId=this.getStorageSync(this.userIdKey),this.enableIdMapping&&(this._userKey=this.getStorageSync(this.userKeyKey))}syncStorage(){this.getStorage(this.uidKey).then(t=>{t||this.setStorage(this.uidKey,this._uid)})}getAppId(){throw Error("this a interface function")}getAppSource(){throw Error("this a interface function")}getPageTitle(t){throw Error("this a interface function")}getPagePath(t){throw Error("this a interface function")}getStorage(t){throw Error("this a interface function")}getStorageSync(t){throw Error("this a interface function")}setStorage(t,e){throw Error("this a interface function")}getSystemInfo(){throw Error("this a interface function")}getNetworkType(){throw Error("this a interface function")}getLocation(t){throw Error("this a interface function")}request({url:t,header:e,method:i,data:n,timeout:o,success:s,fail:r}){throw Error("this a interface function")}collectImp(t,e=null){throw Error("this a interface function")}initShareAppMessage(t){throw Error("this a interface function")}getCurrentPage(){throw Error("this a interface function")}getQuery(){throw Error("this a interface function")}getReferrer(){throw Error("this a interface function")}getInitPath(){throw Error("this a interface function")}onAppShow(t){throw Error("this is a interdace function")}onAppHide(t){throw Error("this is a interface function")}timeoutAbort(t,e){t&&t.abort&&setTimeout(()=>{t.abort()},(e||1e4)+10)}navigateToMiniProgram(){throw Error("this is a interface function")}}class Weixin extends Info{constructor(t){super(t),this.growingio=t}getAppId(){this._systemInfo||(this._systemInfo=wx.getSystemInfoSync());let t=void 0;return 0>Utils.compareVersion(this._systemInfo.SDKVersion,"2.2.2")||(t=wx.getAccountInfoSync().miniProgram.appId),t}getPagePath(){const t=this.getCurrentPage();return t&&t.route}getCurrentPage(){const t=getCurrentPages();return t[t.length-1]}getPageTitle(t){let e="";try{if(t.data.title&&t.data.title.length>0&&(e=Array.isArray(t.data.title)?t.data.title.join(" "):t.data.title),0===e.length&&__wxConfig){if(__wxConfig.tabBar){const i=__wxConfig.tabBar.list.find(e=>e.pathPath==t.route||e.pagePath==`${t.route}.html`);i&&i.text&&(e=i.text)}if(0==e.length){const i=__wxConfig.page[t.route]||__wxConfig.page[`${t.route}.html`];e=i?i.window.navigationBarTitleText:__wxConfig.global.window.navigationBarTitleText}}}catch(t){return""}return e}getStorage(t){return new Promise(e=>{wx.getStorage({key:t,success:t=>e(t.data),fail:()=>e("")})})}getStorageSync(t){return wx.getStorageSync(t)}setStorage(t,e){wx.setStorage({key:t,data:e})}getSystemInfo(){return new Promise(t=>{wx.getSystemInfo({success:e=>{this._systemInfo=e,t(e)},fail:()=>t(null)})})}getNetworkType(){return new Promise(t=>{wx.getNetworkType({success:e=>t(e),fail:()=>t(null)})})}getSetting(){return new Promise(t=>{wx.getSetting({success:t,fail:t})})}getLocation(t){return new Promise(e=>{wx.getLocation({type:t,success:t=>e(t),fail:()=>e(null)})})}request({url:t,header:e,method:i,data:n,timeout:o,success:s,fail:r,complete:a}){const g=wx.request({url:t,header:e,method:i,data:n,timeout:o,success:s,fail:r,complete:a});return super.timeoutAbort(g,o),g}getImageInfo(t){return wx.getImageInfo(t)}collectImp(t,e=null){let i=null;this.growingio.vdsConfig.vue&&(t=t.$mp.page),this.growingio.vdsConfig.taro&&(t=t.$scope);const n={};this.growingio._observer&&this.growingio._observer.disconnect(),this.growingio._observer=t.isComponent?t.createIntersectionObserver({observeAll:!0}):wx.createIntersectionObserver(t,{observeAll:!0}),(i=e?this.growingio._observer.relativeTo(e):this.growingio._observer.relativeToViewport()).observe(".growing_collect_imp",t=>{if(!t.id||n[t.id])return;const e=getManualImpInfo(t.dataset),{eventId:i,properties:o}=e;i&&t.id&&!n[t.id]&&(this.growingio.observer.track(i,o),n[t.id]=!0)})}setStorageSync(t,e){wx.setStorageSync(t,JSON.stringify(e))}removeStorageSync(t){wx.removeStorageSync(t)}navigateTo(t){wx.navigateTo(t)}switchTab(t){wx.switchTab(t)}onAppShow(t){wx.onAppShow(t)}onAppHide(t){wx.onAppHide(t)}navigateToMiniProgram(t){wx.navigateToMiniProgram(t)}}class Config$1{constructor(t){this.growingio=t}setDataCollect(t){"boolean"==typeof t?(this.growingio.vdsConfig.dataCollect=t,console.log(`GrowingIO：已${t?"开启":"关闭"}数据采集`)):console.log("GrowingIO：开启/关闭数据采集失败，请检查参数")}enableDebug(t){t&&console&&(this.growingio.vdsConfig.debug=t)}setTrackerScheme(t){const e=(t+"").toLocaleLowerCase();"http"!==e&&"https"!==e||(this.growingio.vdsConfig.scheme=`${t}://`)}setTrackerHost(t){isString(t)&&(this.growingio.vdsConfig.host=t)}setAutotrack(t){"boolean"==typeof t?(this.growingio.vdsConfig.autotrack=t,console.log(`GrowingIO：已${t?"开启":"关闭"}无埋点事件`)):console.log("GrowingIO：开启/关闭无埋点事件失败，请检查参数")}}const _wrapHook=(t,e,i="")=>{if(e.__gio__)return e;const n=VdsInstrumentAgent.hook(i||e.name,e,t);return n.__gio__=!0,"boolean"==typeof e._stop&&(n._stop=e._stop),n},proxyDispatchEvent=t=>(function(){const e=arguments[0],i=getDataByPath(this,"_root.ctx")||{_growing_page_:!0},n=this.__handlers[e.type];return Array.isArray(n)&&n.forEach((t,e)=>{n[e]=_wrapHook(i,n[e])}),t.apply(this,arguments)}),proxyVueMethod=(t,e,i,n)=>"function"!=typeof i?i:function(){let o=getDataByPath(t,"$el._root.ctx");return o||(o=n.info.getCurrentPage()||{}),_wrapHook(o,i,e).apply(this,arguments)};function proxyTaro3(t,e){if(t.vue)t.vue.mixin({created(){const t=this.$options.methods;if(!t)return;const i=this;Object.keys(t).forEach(t=>{Object.defineProperty(i,t,{value:proxyVueMethod(i,t,i[t],e),configurable:!0,writable:!0})})}});else{const t=document.__proto__.__proto__;Object.defineProperty(t,"dispatchEvent",{value:proxyDispatchEvent(t.dispatchEvent),enumerable:!1,configurable:!0})}}const proxyVue=(t,e)=>{void 0!==t.mixin&&t.mixin({created:function(){if(!this.$options.methods)return;const t=Object.keys(this.$options.methods);for(const e of Object.keys(this))0>t.indexOf(e)||"function"!=typeof this[e]||(Object.defineProperty(this[e],"proxiedName",{value:e}),Object.defineProperty(this[e],"isProxied",{value:!0}))},beforeMount:function(){const t=this.$root;t.$mp&&"page"===t.$mp.mpType?t.$mp.page&&(e.vueRootVMs[t.$mp.page.route]=t):"page"===t.mpType&&"page"===this.mpType&&t.$mp.page&&(e.vueRootVMs[t.$mp.page.route||t.$mp.page.is]=t,-1!==["wx","qq","tt"].indexOf(gioGlobal.gio__platform)&&VdsInstrumentAgent.instrumentPageComponent(t.$mp.page))}}),console.log("prox",e.vueRootVMs)},proxyTaro=(t,e,i)=>{if(isTaro3())return proxyTaro3(t,e);const n=t.createComponent,o=i.usePlugin;if(n&&(t.createComponent=function(t,i){let s=t;for(;s&&s.prototype;){const i=Object.keys(Object.getOwnPropertyDescriptors(s.prototype)||{});for(let n=0;i.length>n;n++)if(i[n].startsWith("func__")){const o=s.name,r=i[n].slice(6);e.taroRootVMs[i[n]]=o+"_"+(""+t.prototype[i[n]]).match(/this\.__triggerPropsFn\("(.+)",/)[1]+"_"+r}s=Object.getPrototypeOf(s)}const r=n(t,i),a=-1!==["MinP","qq"].indexOf(platformConfig$1.platform),g=a?r&&r.methods:r;return o?i&&VdsInstrumentAgent.instrumentPageComponent(g):i&&a&&VdsInstrumentAgent.instrumentPageComponent(g),r}),o&&t.createApp){const e=t.createApp;t.createApp=function(t){const i=e(t);return i._growing_app_=!0,VdsInstrumentAgent.instrument(i),i}}},proxyCml=(t,e)=>{const i=t.createApp,n=t.createComponent;t.createApp=function(t){return t._growing_app_=!0,i(VdsInstrumentAgent.instrument(t))},t.createComponent=function(t){return n(t.data&&t.data.isComponent?Object.assign(Object.assign({},t),{methods:VdsInstrumentAgent.instrument(t.methods)}):t)}},proxyWepy=(t,e,i)=>{const n=t.page,o=function(t){const n=Object.keys(t);for(let o=0;n.length>o;o++){const s=Object.keys(t[n[o]]);for(let r=0;s.length>r;r++)if("function"==typeof t[n[o]][s[r]]){const a=(""+t[n[o]][s[r]]).match(/_vm\.(.+)\(.*\)/);a&&a[1]&&(e.wepyRootVMs[n[o]]||(e.wepyRootVMs[n[o]]={}),e.wepyRootVMs[n[o]][s[r]]=a[1]),i.usePlugin&&(t[n[o]][s[r]]=VdsInstrumentAgent.hook("_proxy",t[n[o]][s[r]]))}}};t.page=function(t,e){return e.handlers&&o(e.handlers),VdsInstrumentAgent.instrumentPageComponent(t),n(t,e)};const s=t.component;if(t.component=function(t,e){return e.handlers&&o(e.handlers),s(t,e)},i.usePlugin){const e=t.app;t.app=function(t,i){return t._growing_app_=!0,e(VdsInstrumentAgent.instrument(t),i)}}},getNewType=t=>t?"CUSTOM_EVENT"==t?"CUSTOM":"VISIT_CLOSED"==t?"APP_CLOSED":t:"LOGIN_USER_ATTRIBUTES",buildContext=(t,e)=>{const i=t.context;let n={deviceId:t.anonymousId,userKey:t.userKey,userId:t.userId,gioId:t.gioId,sessionId:t.session,dataSourceId:t.dataSourceId,eventType:e,globalSequenceId:t.esid,timestamp:t.timestamp};i&&i.page&&(n=Object.assign(Object.assign({},n),{domain:i.page.domain,path:i.page.path,query:i.page.query,title:i.page.title})),i&&i.operationSystem&&(n=Object.assign(Object.assign({},n),{platform:i.device.platform,platformVersion:i.operationSystem.version}));const o=buildAddContext(t);return Object.assign(Object.assign({},n),o)},buildAddContext=t=>{const e=t.context;return{networkState:e.network.type,appChannel:e.app.channel,appVersion:e.app.version,screenWidth:e.screen.width,screenHeight:e.screen.height,deviceBrand:e.device.brand,deviceModel:e.device.model,deviceType:e.operationSystem.name,language:e.locale.language,latitude:e.location.latitude,longitude:e.location.longitude,sdkVersion:t.version}},verifyContext=t=>{const e=t.context;return e&&e.network&&e.app&&e.screen},buildPage=t=>{const e=t.context;return{sdkVersion:t.version,appVersion:e.app.version,timestamp:t.sendTime,referralPage:e.referrer?e.referrer.page:void 0}},buildCustom=t=>{return{eventName:t.eventKey,pageShowTimestamp:t.context.page.time,attributes:t.attributes,resourceItem:t.item}},buildAppClose=t=>{return{networkState:t.context.network.type}},buildLocalUser=t=>{let e=t.attributes||{};const i=t.profile;return i&&(e=Object.values(i).reduce((t,e)=>Object.assign(t,e),e)),{attributes:e}},buildAction=(t,e,i)=>{const n=e.context.page.time;return e.elements.map(e=>Object.assign(Object.assign({},t),{pageShowTimestamp:n,textValue:e.v,xpath:e.x,index:e.idx,hyperlink:e.h,eventSequenceId:i}))},buildNewIdMap=(t=>e=>{if(t){return Object.assign(t,{[e]:t[e]?+t[e]+1:1})}return t={[e]:1}})(),eventCache=[],toEvent3WithCache=(t,e)=>{const i=e.context,n=eventCache.reduce((e,n)=>(n.context=Object.assign(Object.assign({},i),n.context),e.concat(toEvent3(t,n))),[]);return eventCache.splice(0,eventCache.length),[...n,...toEvent3(t,e)]},toEvent3=(t,e)=>{const i=getNewType(e.type),n=buildContext(e,i),o=buildNewIdMap(i);switch(i){case"VISIT":return[Object.assign(Object.assign({},n),{eventSequenceId:o[i]})];case"PAGE":return[Object.assign(Object.assign(Object.assign({},n),buildPage(e)),{eventSequenceId:o[i]})];case"CUSTOM":return[Object.assign(Object.assign(Object.assign({},n),buildCustom(e)),{eventSequenceId:o[i]})];case"APP_CLOSED":return[Object.assign(Object.assign(Object.assign({},n),buildAppClose(e)),{eventSequenceId:o[i]})];case"LOGIN_USER_ATTRIBUTES":return[Object.assign(Object.assign(Object.assign({},n),buildLocalUser(e)),{eventSequenceId:o[i]})];case"VIEW_CLICK":case"FORM_SUBMIT":case"VIEW_CHANGE":return buildAction(n,e,o[i])}},cdpEventV2ToV3=(t,e)=>verifyContext(e)?toEvent3WithCache(t,e):(eventCache.push(e),[]),sdkVer="3.3.2";class growingio{constructor(){this.config=new Config$1(this),this.uploadingMessages=[],this.launcher=[]}init(t,e,i,n){this.start||(i&&"string"!=typeof i&&(n=i,i=void 0),i||n||(i=void 0,n={}),n.host&&e&&t?("alip"===platformConfig$1.platform&&(n.vue||n.taro||n.cml||n.wepy)&&(platformConfig$1.canHook=!0),n.usePlugin&&(platformConfig$1.canHook=!1),this.vdsConfig={projectId:t,dataSourceId:e,appId:i,appVer:n.version||"",sdkVer:sdkVer,dataCollect:!1!==n.dataCollect||n.dataCollect,host:n.host,gtouchHost:n.gtouchHost,scheme:n.scheme||"https://",getLocation:n.getLocation||!1,debug:n.debug,usePlugin:n.usePlugin||!1,vue:n.vue||!1,taro:n.taro||!1,cml:n.cml||!1,wepy:n.wepy||!1,getInfoHook:defineInfoHook(n.getInfoHook),followShare:void 0!==n.followShare&&n.followShare,forceLogin:n.forceLogin||!1,comAsPage:n.comAsPage||!1,compress:n.compress||!1,autotrack:!1!==n.autotrack||n.autotrack,ignoreFields:getValidIgnoreFields(n.ignoreFields),enableIdMapping:!0===n.enableIdMapping,enableEventStore:!0===n.enableEventStore},gioGlobal.vdsConfig=this.vdsConfig,gioGlobal.platformConfig=platformConfig$1,this.setTrackerHost(n.host),this.setTrackerScheme(n.scheme),this.info=new Weixin(this),this.observer=new Observer(this),this.uploader=new CdpUploader(this),i||(this.vdsConfig.appId=this.info.getAppId()),this._start(),this.vdsConfig.ignoreFields&&console&&console.log("%cGrowingIO 忽略以下字段上报: ["+this.vdsConfig.ignoreFields.join(", ")+"]。","color: #C2950D")):console.error("GrowingIO SDK初始化失败，请检查你的dataSourceId, projectId 和 host 是否配置正确"))}setConfig(t){this.init(t.projectId,t.dataSourceId,t.appId,t)}send(){this.start=!0,this.vdsConfig.host&&this.appListener()}setTrackerScheme(t){this.config.setTrackerScheme(t)}setTrackerHost(t){this.config.setTrackerHost(t)}enableDebug(t){this.config.enableDebug(t)}setDataCollect(t){if(this.config.setDataCollect(t),t&&!this.observer.vstSended){const t=this.uploadingMessages.find(t=>"VISIT"===t.type);t&&(this.observer._sendEvent(t),this.uploadingMessages=[])}}setAutotrack(t){this.config.setAutotrack(t)}appListener(){this.observer.sendVisitEvent(),this.launcher.length>0&&this.launcher.map(t=>{this.observer[t[0]].apply(this.observer,t[1])})}proxy(t,e){try{if("login"==t)return;if(this[t])this[t].apply(this,e);else if(this.observer&&this.observer[t]){if(this.start||["setUserId","clearUserId","getGioInfo"].includes(t))return this.observer[t].apply(this.observer,e);this.launcher.push([t,e])}}catch(t){console&&console.error(t)}}login(t){if(this.vdsConfig.forceLogin){if(this.info.uid=t,this.vdsConfig.forceLogin=!1,this.vdsConfig.dataCollect)for(const e of this.uploadingMessages)e.anonymousId=t,this.upload(e)}else console.error("GrowingIO: 无效操作！forceLogin为false。")}upload(t){if(this.vdsConfig.forceLogin)console.warn("GrowingIO: [ForceLogin] is set to true, but openID is null, data collection has been suspended! Call the [identify] function to report openID to resume data collection."),this.uploadingMessages.push(t);else{const e=this.vdsConfig.ignoreFields;gioEmitter.emitEvent("upload",[t]),cdpEventV2ToV3(this.info,t).forEach(t=>{e&&(t=omit(t,...e)),this.vdsConfig.debug&&console.info("generate new event",JSON.stringify(t,0,2)),this.uploader.upload(t)})}}_start(){this.info.onAppHide||(this.vdsConfig.canHide=!0),this._hookPage()}_getOption(t){this.observer.currentScene=t.scene,this.observer.path=t.path,this.observer.query=t.query}_hookPage(){this.vdsConfig.taro?(this.taroRootVMs={},proxyTaro(this.vdsConfig.taro,this,this.vdsConfig)):this.vdsConfig.wepy?(this.wepyRootVMs={},proxyWepy(this.vdsConfig.wepy,this,this.vdsConfig)):this.vdsConfig.cml?(gioGlobal.platformConfig.hooks.Component=!1,proxyCml(this.vdsConfig.cml)):this.vdsConfig.vue&&(this.vueRootVMs={},proxyVue(this.vdsConfig.vue,this)),VdsInstrumentAgent.initInstrument(this.observer);try{gioGlobal&&platformConfig$1.canHook&&platformConfig$1.hooks.Page&&(gioGlobal.Page=Page)}catch(t){}}}function isEqual(t,e){if(typeof t!=typeof e)return!1;if("string"==typeof t||"number"==typeof t||"boolean"==typeof t||"function"==typeof t||void 0==t||void 0==e)return Object.is(t,e);if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every((t,i)=>isEqual(t,e[i]));if("[object Object]"===Object.prototype.toString.call(t)&&"[object Object]"===Object.prototype.toString.call(e)){const i=Object.keys(t),n=Object.keys(e);return!(!i.every(i=>e.hasOwnProperty(i)&&isEqual(t[i],e[i]))||!n.every(i=>t.hasOwnProperty(i)&&isEqual(e[i],t[i])))}return!1}const getParameterByName=(t,e)=>{if("string"!=typeof e)return;"?"!==e[0]&&(e="?"+e),t=t.replace(/[[\]]/g,"\\$&");const i=RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null};class BaseUserStorage{constructor(t){this.growingio=t,this.namespace="push-user-status",this.userTagDuration=432e7,this.eventTagDuration=864e5,this.handleCs1=this.handleCs1.bind(this),this.handleClearCs1=this.handleClearCs1.bind(this)}handleCs1(t){t!==this.get("cs1")&&(this.set("cs1",t),this.set("bcs",void 0),gioEmitter.emit("cs1Refresh"))}handleClearCs1(){this.set("cs1",void 0),this.set("bcs",void 0)}setIsPreview(t){if(!t.q)return;const e=getParameterByName("scene",t.q);if(!e)return;const i=getParameterByName("gioMessageId",e);if(!i)return;const n={s:"splash",pw:"popupWindow",p:"push",b:"banner",ab:"abTest"}[getParameterByName("mt",e)]||"";gioGlobal.__growing__.marketingPreview={messageId:i,msgType:n}}storeFilters(t,e,i){const n=e(),o=this.get(n,this.eventTagDuration)||[],s=i.call(this,t);if(!this.growingio.vdsConfig.enableEventStore&&n.indexOf("triggerAttrs")>-1)this.set(n,[]);else{const t=[...o,...s];this.set(n,t)}}generateEventKey(t){return`${t}#${this.get("cs1")||""}`}_get(t){return this.growingio.info.getStorageSync(`${this.namespace}#${t}`)}getUserAttrs(){const t=this.generateEventKey("userAttrs");return this.get(t)||[]}getTriggerAttrs(){const t=this.generateEventKey("triggerAttrs");return this.get(t)||[]}set(t,e){const i=this._get(t),n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0);const o={startAt:n.getTime(),value:e};i&&isEqual(o.value,JSON.parse(i).value)||this.growingio.info.setStorageSync(`${this.namespace}#${t}`,o)}get(t,e=this.userTagDuration){const i=this._get(t);if(!i)return;const n=JSON.parse(i);return Date.now()>n.startAt+e?void 0:n.value}getCs1(){return this.get("cs1")}}class UserStorage extends BaseUserStorage{constructor(t){super(t),this.growingio=t,this.handleEvent=this.handleEvent.bind(this),this.addEventListener()}addEventListener(){gioEmitter.on("appOpen",this.handleEvent),gioEmitter.on("upload",this.handleEvent),gioEmitter.on("setCs1",this.handleCs1),gioEmitter.on("clearCs1",this.handleClearCs1)}handleEvent(t){if(!t)return;switch(t.type||"USER_EVENT"){case"VISIT":this.storeFilters(t,this.generateEventKey.bind(this,"userAttrs"),this.formatUserFilterVars);break;case"CUSTOM_EVENT":this.storeFilters(t,this.generateEventKey.bind(this,"triggerAttrs"),this.formatEventFilterVars);case"PAGE":this.setIsPreview(t);break;case"USER_EVENT":this.storeFilters(t,this.generateEventKey.bind(this,"userAttrs"),this.formatUserFilterVars)}}formatUserFilterVars(t){const e=t.attributes;return e?Object.keys(e).map(t=>({key:t,value:e[t]})):[]}formatEventFilterVars(t){const e=t.attributes;return[{key:t.eventKey,value:"",event_variable:e?Object.keys(e).map(t=>({key:t,value:e[t]})):[]}]}}try{const t="wx";initGlobal(t),"frame"!==t&&(gioGlobal.gio__platform=t)}catch(t){}const growingio$1=new growingio,gio=function(){const t=arguments[0];if(!t)return;const e=2>arguments.length?[]:[].slice.call(arguments,1);if("init"===t){if(gioGlobal.vdsConfig)return void console.warn("SDK已经初始化成功，请检查是否加载过其他平台sdk");if(1>e.length)return void console.log('初始化 GrowingIO SDK 失败。请使用 gio("init", "你的GrowingIO项目ID", "你的应用APP_ID", options);');const t=e[0],i=e[1],n=e[2],o=e[3];o&&!1===o.autotrack&&console.log("GrowingIO：已关闭无埋点事件"),growingio$1.init(t,i,n,o)}else{if("setConfig"!==t)return growingio$1.proxy(t,e);if(!e[0])return void console.log("初始化 GrowingIO SDK 失败。请检查你的config文件是否引入正确");if(!e[0].projectId)return void console.log("初始化 GrowingIO SDK 失败。请检查你的 GrowingIO项目ID, 你的应用APP_ID 是否填写正确");growingio$1.setConfig(e[0])}};console.log("init growingio...");const GioPage=VdsInstrumentAgent.GrowingPage,GioComponent=VdsInstrumentAgent.GrowingComponent,GioBehavior=VdsInstrumentAgent.GrowingBehavior,gioEmitter$1=gioEmitter,userStorage=new UserStorage(growingio$1);gioGlobal.__growing__={gioEmitter:gioEmitter$1,gio:gio,growingio:growingio$1,userStorage:userStorage,marketingPreview:void 0,entry:"cdp"},gioGlobal.gio=gio,exports.GioBehavior=GioBehavior,exports.GioComponent=GioComponent,exports.GioPage=GioPage,exports.default=gio,exports.gioEmitter=gioEmitter$1,exports.growingio=growingio$1;
// #endif